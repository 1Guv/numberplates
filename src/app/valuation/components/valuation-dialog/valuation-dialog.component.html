

<div class="d-flex flex-row-reverse">
  <mat-icon mat-dialog-close matSuffix (click)="onCloseValuationDialog()">close</mat-icon>
</div>

<div class="d-flex flex-column align-items-center justify-content-center">
  <div>
    <div *ngIf="stepZeroForm.get('plate').value?.length > 0" class="w-100">
      <span class="plate-css text-uppercase mat-elevation-z4">
        {{ stepZeroForm.get('plate').value }}
      </span>

      <div class="w-100 mt-2 text-center" *ngIf="stepZeroForm.valid">
        <!-- £{{ calcPriceBeforeQuestions(stepZeroForm.get('platePrice').value) }} -->
        £{{ stepZeroForm.get('plateValB4Q').value }}
      </div>

      <div class="w-100 mt-2 text-center" *ngIf="stepZeroForm.valid">
        £{{ stepZeroForm.get('valuationPrice').value | decimal:0 }}
      </div>
    </div>
  </div>

  <mat-vertical-stepper [linear]="isLinear" #stepper class="mt-4">

      <mat-step [stepControl]="stepZeroForm">
        <form [formGroup]="stepZeroForm">
          <ng-template matStepLabel>Plate, Type & Year</ng-template>

          <!-- Plate -->
          <mat-form-field appearance="fill">
            <mat-label>Plate</mat-label>
            <input matInput type="text" maxLength="8" placeholder="1 51NGH" formControlName="plate" required>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Price Bought</mat-label>
            <input matInput type="number" placeholder="£1,000" formControlName="platePrice" required>
          </mat-form-field>

          <!-- Plate Types -->
          <mat-form-field appearance="fill">
            <mat-label>Plate Types</mat-label>
            <mat-select formControlName="plateType">
              <mat-option *ngFor="let type of plateTypes" [value]="type.value">
                {{ type.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Suffix Years -->
          <mat-form-field *ngIf="stepZeroForm.get('plateType').value === 'suffix'" appearance="fill">
            <mat-label>Suffix Years</mat-label>
            <mat-select formControlName="plateYear">
              <mat-option *ngFor="let suffix of suffixYears" [value]="suffix.year">
                {{ suffix.reg }} - {{ suffix.year }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Prefix Years -->
          <mat-form-field *ngIf="stepZeroForm.get('plateType').value === 'prefix'" appearance="fill">
            <mat-label>Prefix Years</mat-label>
            <mat-select formControlName="plateYear">
              <mat-option *ngFor="let prefix of prefixYears" [value]="prefix.year">
                {{ prefix.reg }} - {{ prefix.year }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Current Years -->
          <mat-form-field *ngIf="stepZeroForm.get('plateType').value === 'current'" appearance="fill">
            <mat-label>Current Years</mat-label>
            <mat-select formControlName="plateYear">
              <mat-option *ngFor="let current of currentYears" [value]="current.year">
                {{ current.reg }} - {{ current.year }} - {{ current.month }}
              </mat-option>
            </mat-select>
          </mat-form-field>

           <!-- Year bought -->
           <mat-form-field
            appearance="fill"
            *ngIf="
            stepZeroForm.get('plateType').value === 'dateless' ||
            stepZeroForm.get('plateType').value === 'irish'">
            <mat-label>Year Bought</mat-label>
            <input
              matInput
              type="text"
              numbersOnly
              maxlength="4"
              minlength="4"
              formControlName="plateYear"
              required>
          </mat-form-field>


          <button [disabled]="stepZeroForm.invalid" mat-button matStepperNext>Next</button>
        </form>
      </mat-step>

      <mat-step [stepControl]="stepOneForm">
        <form [formGroup]="stepOneForm">
          <ng-template matStepLabel>Meaning</ng-template>
          <mat-form-field appearance="fill">
            <mat-label>Meaning</mat-label>
            <input matInput type="text" formControlName="meaning" placeholder="SINGH"
                    required>
          </mat-form-field>
          <div>
            <button mat-button matStepperPrevious>Back</button>
            <button mat-button matStepperNext>Next</button>
          </div>
        </form>
      </mat-step>

      <mat-step [stepControl]="stepTwoForm">
        <form [formGroup]="stepTwoForm">
          <ng-template matStepLabel>Questions</ng-template>
            <div style="display: inline-block;">Q1: Does the plate have more characters than the meaning?</div>
            <mat-slide-toggle
              (change)="onQuestionChangePriceDec($event, stepZeroForm.get('plateValB4Q').value, q1Value)"
              formControlName="q1">
              Yes
            </mat-slide-toggle>
            <br><br>

            <div style="display: inline-block;">Q2:Do you have consecutive matching numbers or letters in your plate combination?</div>
            <mat-slide-toggle
              (change)="onQuestionChangePriceDec($event, stepZeroForm.get('plateValB4Q').value, q2Value)"
              formControlName="q2">
              Yes
            </mat-slide-toggle>
            <br><br>

            <div style="display: inline-block;">Q3:Do you need to modify a character to look like another character?</div>
            <mat-slide-toggle
              (change)="onQuestionChangePriceDec($event, stepZeroForm.get('plateValB4Q').value, q3Value)"
              formControlName="q3">
              Yes
            </mat-slide-toggle>
            <br><br>

            <div style="display: inline-block;">Q4: Do you have more than 1 space between words and numbers?</div>
            <mat-slide-toggle
              (change)="onQuestionChangePriceDec($event, stepZeroForm.get('plateValB4Q').value, q4Value)"
              formControlName="q4">
              Yes
            </mat-slide-toggle>
          <div>
            <button mat-button matStepperPrevious>Back</button>
            <button mat-button matStepperNext>Next</button>
          </div>
        </form>
      </mat-step>

      <mat-step [stepControl]="stepThreeForm">
        <form [formGroup]="stepThreeForm">
          <ng-template matStepLabel>More Questions</ng-template>
            <div style="display: inline-block;">Q5: Does the plate have a single 1?</div>
            <mat-slide-toggle
              (change)="onQuestionChangePriceInc($event, stepZeroForm.get('valuationPrice').value, q5Value)"
              formControlName="q5">
              Yes
            </mat-slide-toggle>
            <br><br>

            <div style="display: inline-block;">Q6: Is this a popular word!</div>
            <mat-slide-toggle
              (change)="onQuestionChangePriceInc($event, stepZeroForm.get('valuationPrice').value, q6Value)"
              formControlName="q6">
              Yes
            </mat-slide-toggle>
            <br><br>
            <div>
              <button mat-button matStepperPrevious>Back</button>
              <button mat-button matStepperNext>Next</button>
            </div>
        </form>
      </mat-step>

      <mat-step>
        <ng-template matStepLabel>Summary</ng-template>
        <div>
          <div *ngIf="stepZeroForm.get('plate').value?.length > 0" class="w-100">
            <span class="plate-css text-uppercase mat-elevation-z4">
              {{ stepZeroForm.get('plate').value }}
            </span>
          </div>

          <div *ngIf="stepZeroForm.get('plateType').value" class="my-3">
            Type: {{ stepZeroForm.get('plateType').value | uppercase }}
          </div>

          <div *ngIf="stepZeroForm.get('platePrice').value" class="my-3">
            Price bought: £{{ stepZeroForm.get('platePrice').value }}
          </div>

          <div *ngIf="stepZeroForm.get('plateYear').value" class="my-3">
            Age: {{ plateAge }}
          </div>

          <div *ngIf="stepOneForm.get('meaning').value" class="my-3 w-100">
            Meaning: {{ stepOneForm.get('meaning').value | uppercase }}
          </div>

          <div *ngIf="stepZeroForm.get('plateValB4Q').value" class="my-3 w-100">
            Plate Value before questions: £{{ stepZeroForm.get('plateValB4Q').value }}
          </div>

          <div *ngIf="stepZeroForm.get('valuationPrice').value" class="my-3 w-100">
            Current Valuation: £{{ stepZeroForm.get('valuationPrice').value | number}}
          </div>

          <div *ngIf="stepZeroForm.get('valuationPrice').value" class="my-3 w-100">
            Percentage Inc/Dec: {{ ((stepZeroForm.get('valuationPrice').value / stepZeroForm.get('platePrice').value) * 100) | number }}%
          </div>

          <div *ngIf="stepZeroForm.get('valuationPrice').value" class="my-3 w-100">
            Profit: £{{ (stepZeroForm.get('valuationPrice').value - stepZeroForm.get('platePrice').value | number) }}
          </div>
        </div>
        <p>You are now done.</p>
        <div>
          <button mat-button matStepperPrevious>Back</button>
          <button mat-button (click)="reset()">Reset</button>
        </div>
      </mat-step>

    </mat-vertical-stepper>

</div>
